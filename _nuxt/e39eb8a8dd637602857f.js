(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{214:function(t,e,n){"use strict";n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return f})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return m}));n(18);var r=n(49),o=n.n(r),c=(n(215),n(69)),l=function(t,e,n,r){o.a.auth().signInWithEmailAndPassword(t,e).then((function(t){m("loginCount",t.user.uid),n(t.user.uid)})).catch((function(t){r(t.message)}))},f=function(t){o.a.auth().signOut().then(t)},d=function(t){var e=t.uid,n=t.city,r=t.nickname;return new Promise((function(t,o){c.b.ref("users/".concat(e)).update({city:n,nickname:r},(function(e){e?o(e):t()}))}))},h=function(t){return new Promise((function(e){c.b.ref("users/".concat(t)).once("value").then((function(t){return e(t.val())}))}))},m=function(t,e){return new Promise((function(n,r){console.log("rrrr","users/".concat(e,"/").concat(t)),c.b.ref("users/".concat(e,"/").concat(t)).transaction((function(t){return null===t?1:t+1}),(function(t,e){null===t&&e&&n(),r(t)}))}))}},216:function(t,e,n){"use strict";n.d(e,"a",(function(){return y})),n.d(e,"d",(function(){return x})),n.d(e,"c",(function(){return O})),n.d(e,"b",(function(){return _})),n.d(e,"g",(function(){return R})),n.d(e,"f",(function(){return z})),n.d(e,"e",(function(){return P}));n(93),n(28),n(50),n(20),n(70);var r=n(13),o=(n(37),n(5)),c=(n(18),n(69)),l=n(49),f=n.n(l),d=(n(215),n(213)),h=n.n(d),m=n(214),j=n(217);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function k(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var w=function(){return new Promise((function(t){f.a.auth().onAuthStateChanged((function(e){t(!!e&&e.uid)}))}))},y=function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w();case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),x=function(t,e){w()&&c.b.ref("commentReply").push(k({},t,{uid:e}),(function(t){if(t)alert("回復訊息出現錯誤"),console.log(t);else try{Object(m.a)("replyCount",e)}catch(t){console.log("紀錄回覆數錯誤",t)}}))},O=function(t){var e=[],n={};return c.b.ref("commentReply").orderByChild("id").equalTo(t).on("child_added",function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(r){var data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(data=r.val(),!n[data.uid]){t.next=5;break}data.avatar=n[data.uid],t.next=9;break;case 5:return t.next=7,Object(j.a)(data.uid);case 7:data.avatar=t.sent,n[data.uid]=data.avatar;case 9:e.push(k({key:r.key},data));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e},_=function(){return new Promise((function(t,e){c.b.ref("commentRank").orderByValue().limitToLast(1).once("value",function(){var n=Object(o.a)(regeneratorRuntime.mark((function n(r){var o,c,l,f,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.val()){n.next=8;break}return o=Object.keys(r.val())[0],n.next=4,R(o);case 4:for(f in c=n.sent,l=[],c)data=c[f],l.push(k({id:f},data));t([o,l]);case 8:e(null);case 9:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}))},R=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=c.b.ref("comment/".concat(t)).orderByChild("d").limitToLast(e),r={};return new Promise((function(t){n.on("value",function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(n){var o,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.val(),e.t0=regeneratorRuntime.keys(o);case 2:if((e.t1=e.t0()).done){e.next=15;break}if(c=e.t1.value,data=o[c],!r[data.u]){e.next=9;break}data.avatar=r[data.u],e.next=13;break;case 9:return e.next=11,Object(j.a)(data.u);case 11:data.avatar=e.sent,r[data.u]=data.avatar;case 13:e.next=2;break;case 15:t(o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))},z=function(t,e,u){return new Promise((function(n){if(w()){c.b.ref("comment").child(e).push({u:u,msg:t,d:h()().format("YYYY-MM-DD HH:mm:ss")});try{Promise.all([Object(m.a)("commitCount",u),C(e)]).then((function(){return n()}))}catch(t){alert("留言失敗"),n()}}}))},C=function(t){return new Promise((function(e,n){c.b.ref("commentRank/".concat(t)).transaction((function(t){return t?t+1:1}),(function(t,r){null===t&&r&&e(),n(t)}))}))},P=function(){var t=c.b.ref("user-release");return new Promise((function(e){t.once("value",(function(n){t.set(n.val()+1),e(n.val()+1)}))}))}},217:function(t,e,n){"use strict";n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return d}));n(37);var r=n(5),o=(n(71),n(18),n(49)),c=n.n(o),l=(n(350),n(69));function f(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=l.b.ref("users");return new Promise((function(l,f){var d=c.a.storage().ref(),h={contentType:t.type},m=Date.now()+t.name,j=d.child(m).put(t,h);j.on("state_changed",n,(function(){}),Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.child(e).once("value");case 3:if(n=t.sent,!(r=n.val())||!r.filename){t.next=8;break}return t.next=8,c.a.storage().ref().child(r.filename).delete();case 8:return t.next=10,j.snapshot.ref.getDownloadURL();case 10:d=t.sent,o.child(e).update({filename:m}),l(d),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),console.log("happen error",t.t0),f(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,15]])}))))}))}function d(t){return new Promise((function(e){l.b.ref("users").child(t).once("value",function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=n.val())||!r.filename){t.next=6;break}return t.next=4,c.a.storage().ref().child(r.filename).getDownloadURL();case 4:o=t.sent,e(o);case 6:e(null);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))}},218:function(t,e,n){"use strict";n.d(e,"e",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"a",(function(){return f})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return h}));n(20),n(70),n(18),n(37);var r=n(5),o=n(69).b.ref("favorite"),c=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e,n,caption){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o.child(e).child(n).set({caption:caption,addTime:Date.now()});case 1:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),l=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o.child(e).child(n).remove();case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),f=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){o.child(e).once("value",(function(e){var n=e.val();t(n||{})}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){o.child(e).once("value",(function(e){var n=e.val();t(n||{})}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f(e);case 2:return n=t.sent,n=Object.keys(n),t.abrupt("return",n.length);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},351:function(t,e,n){var map={"./af":219,"./af.js":219,"./ar":220,"./ar-dz":221,"./ar-dz.js":221,"./ar-kw":222,"./ar-kw.js":222,"./ar-ly":223,"./ar-ly.js":223,"./ar-ma":224,"./ar-ma.js":224,"./ar-sa":225,"./ar-sa.js":225,"./ar-tn":226,"./ar-tn.js":226,"./ar.js":220,"./az":227,"./az.js":227,"./be":228,"./be.js":228,"./bg":229,"./bg.js":229,"./bm":230,"./bm.js":230,"./bn":231,"./bn.js":231,"./bo":232,"./bo.js":232,"./br":233,"./br.js":233,"./bs":234,"./bs.js":234,"./ca":235,"./ca.js":235,"./cs":236,"./cs.js":236,"./cv":237,"./cv.js":237,"./cy":238,"./cy.js":238,"./da":239,"./da.js":239,"./de":240,"./de-at":241,"./de-at.js":241,"./de-ch":242,"./de-ch.js":242,"./de.js":240,"./dv":243,"./dv.js":243,"./el":244,"./el.js":244,"./en-SG":245,"./en-SG.js":245,"./en-au":246,"./en-au.js":246,"./en-ca":247,"./en-ca.js":247,"./en-gb":248,"./en-gb.js":248,"./en-ie":249,"./en-ie.js":249,"./en-il":250,"./en-il.js":250,"./en-nz":251,"./en-nz.js":251,"./eo":252,"./eo.js":252,"./es":253,"./es-do":254,"./es-do.js":254,"./es-us":255,"./es-us.js":255,"./es.js":253,"./et":256,"./et.js":256,"./eu":257,"./eu.js":257,"./fa":258,"./fa.js":258,"./fi":259,"./fi.js":259,"./fo":260,"./fo.js":260,"./fr":261,"./fr-ca":262,"./fr-ca.js":262,"./fr-ch":263,"./fr-ch.js":263,"./fr.js":261,"./fy":264,"./fy.js":264,"./ga":265,"./ga.js":265,"./gd":266,"./gd.js":266,"./gl":267,"./gl.js":267,"./gom-latn":268,"./gom-latn.js":268,"./gu":269,"./gu.js":269,"./he":270,"./he.js":270,"./hi":271,"./hi.js":271,"./hr":272,"./hr.js":272,"./hu":273,"./hu.js":273,"./hy-am":274,"./hy-am.js":274,"./id":275,"./id.js":275,"./is":276,"./is.js":276,"./it":277,"./it-ch":278,"./it-ch.js":278,"./it.js":277,"./ja":279,"./ja.js":279,"./jv":280,"./jv.js":280,"./ka":281,"./ka.js":281,"./kk":282,"./kk.js":282,"./km":283,"./km.js":283,"./kn":284,"./kn.js":284,"./ko":285,"./ko.js":285,"./ku":286,"./ku.js":286,"./ky":287,"./ky.js":287,"./lb":288,"./lb.js":288,"./lo":289,"./lo.js":289,"./lt":290,"./lt.js":290,"./lv":291,"./lv.js":291,"./me":292,"./me.js":292,"./mi":293,"./mi.js":293,"./mk":294,"./mk.js":294,"./ml":295,"./ml.js":295,"./mn":296,"./mn.js":296,"./mr":297,"./mr.js":297,"./ms":298,"./ms-my":299,"./ms-my.js":299,"./ms.js":298,"./mt":300,"./mt.js":300,"./my":301,"./my.js":301,"./nb":302,"./nb.js":302,"./ne":303,"./ne.js":303,"./nl":304,"./nl-be":305,"./nl-be.js":305,"./nl.js":304,"./nn":306,"./nn.js":306,"./pa-in":307,"./pa-in.js":307,"./pl":308,"./pl.js":308,"./pt":309,"./pt-br":310,"./pt-br.js":310,"./pt.js":309,"./ro":311,"./ro.js":311,"./ru":312,"./ru.js":312,"./sd":313,"./sd.js":313,"./se":314,"./se.js":314,"./si":315,"./si.js":315,"./sk":316,"./sk.js":316,"./sl":317,"./sl.js":317,"./sq":318,"./sq.js":318,"./sr":319,"./sr-cyrl":320,"./sr-cyrl.js":320,"./sr.js":319,"./ss":321,"./ss.js":321,"./sv":322,"./sv.js":322,"./sw":323,"./sw.js":323,"./ta":324,"./ta.js":324,"./te":325,"./te.js":325,"./tet":326,"./tet.js":326,"./tg":327,"./tg.js":327,"./th":328,"./th.js":328,"./tl-ph":329,"./tl-ph.js":329,"./tlh":330,"./tlh.js":330,"./tr":331,"./tr.js":331,"./tzl":332,"./tzl.js":332,"./tzm":333,"./tzm-latn":334,"./tzm-latn.js":334,"./tzm.js":333,"./ug-cn":335,"./ug-cn.js":335,"./uk":336,"./uk.js":336,"./ur":337,"./ur.js":337,"./uz":338,"./uz-latn":339,"./uz-latn.js":339,"./uz.js":338,"./vi":340,"./vi.js":340,"./x-pseudo":341,"./x-pseudo.js":341,"./yo":342,"./yo.js":342,"./zh-cn":343,"./zh-cn.js":343,"./zh-hk":344,"./zh-hk.js":344,"./zh-tw":345,"./zh-tw.js":345};function r(t){var e=o(t);return n(e)}function o(t){if(!n.o(map,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return map[t]}r.keys=function(){return Object.keys(map)},r.resolve=o,t.exports=r,r.id=351},355:function(t,e,n){var content=n(387);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(27).default)("92f8e3ea",content,!0,{sourceMap:!1})},356:function(t,e,n){var content=n(389);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(27).default)("b4737e3a",content,!0,{sourceMap:!1})},357:function(t,e,n){var content=n(393);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(27).default)("7da45887",content,!0,{sourceMap:!1})},386:function(t,e,n){"use strict";var r=n(355);n.n(r).a},387:function(t,e,n){(e=n(26)(!1)).push([t.i,'.circle-menu{width:200px;height:200px;background-color:#0071d5;position:fixed;right:-100px;top:-100px;transition:all 1s;border-radius:50%;z-index:99}.circle-menu.drop{width:100%;height:100%;border-radius:0;right:0;top:0;z-index:101}.menu-icon{position:absolute;bottom:10px;left:65px;font-size:1.6rem;color:#fff;transition:opacity 1s;opacity:1}.circle-menu.drop>.menu-icon{transition:opacity 1s;opacity:0}.menu-items{position:absolute;width:100%;height:250px;margin:auto}.user-function{width:250px;list-style-type:none;border-left:5px solid #fff;padding:10px 0;margin:30px auto auto}.user-function:after{content:"";width:100%;height:5px;background-color:#fff;margin-left:-20px;display:block}.user-function>li{box-sizing:border-box;padding:20px;color:#fff;cursor:pointer}@-webkit-keyframes user-fn-animation{0%{transform:translateX(200%)}to{transform:translateX(0);display:block}}@keyframes user-fn-animation{0%{transform:translateX(200%)}to{transform:translateX(0);display:block}}.user-function>li:hover{background-color:rgba(28,79,113,.4902)}.close-wrap{width:250px;text-align:right;margin:auto}.menu-icon2{font-size:1.6rem;color:#fff;cursor:pointer}.link-style,.link-style:hover{color:#fff;display:block;width:100%;height:100%;text-decoration:none;cursor:pointer}.favorite-count{margin-left:10px}',""]),t.exports=e},388:function(t,e,n){"use strict";var r=n(356);n.n(r).a},389:function(t,e,n){(e=n(26)(!1)).push([t.i,".bg-wrap{position:relative;z-index:100}",""]),t.exports=e},391:function(t,e,n){t.exports=n.p+"img/b526035.svg"},392:function(t,e,n){"use strict";var r=n(357);n.n(r).a},393:function(t,e,n){(e=n(26)(!1)).push([t.i,".loading-wrap[data-v-4746ffce]{position:fixed;z-index:999;top:0;bottom:0;left:0;right:0;background:hsla(0,0%,45.5%,.74902)}.loading-wrap>img[data-v-4746ffce]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:200px}",""]),t.exports=e},444:function(t,e,n){"use strict";n.r(e);n(37);var r=n(5),o=(n(72),n(214)),c=n(218),l={data:function(){return{drop:!1,favoriteCount:0}},watch:{drop:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t&&e.$store.state.authentication&&e.$store.state.updateFavorite)){n.next=6;break}return n.next=3,Object(c.b)(e.$store.state.authentication);case 3:r=n.sent,e.favoriteCount=r,e.$store.dispatch("setShouldUpdateFavorite",!1);case 6:case"end":return n.stop()}}),n)})))()}},methods:{userLogoutCallback:function(){this.drop=!1,this.$store.dispatch("setLoginStatus",!1),this.$store.dispatch("setUsername",""),alert("已成功登出"),"/"!==this.$route.path&&this.$router.replace("/")},toggleMenu:function(){this.drop=!this.drop},singout:function(){Object(o.e)(this.userLogoutCallback)},gotoRecommend:function(){this.drop=!1,this.$router.push("/recommend")},goIndex:function(){var t=this;this.drop=!1,setTimeout((function(){t.$router.push("/")}),1e3)},goSetting:function(){this.drop=!1,this.$router.push("/profile")}}},f=(n(386),n(25)),menu=Object(f.a)(l,(function(){var t,e=this,n=e.$createElement,r=e._self._c||n;return r("div",[r("div",{class:(t={},t["circle-menu"]=!0,t.drop=e.drop,t)},[r("font-awesome-icon",{staticClass:"menu-icon",attrs:{icon:"bars"},on:{click:e.toggleMenu}}),e._v(" "),e.drop?r("div",{staticClass:"menu-items"},[e.$store.state.authentication?r("ul",{staticClass:"user-function"},["/"!==e.$route.path?r("li",{staticClass:"link-style",on:{click:e.goIndex}},[e._v("\n          回首頁\n        ")]):e._e(),e._v(" "),r("li",{on:{click:e.gotoRecommend}},[e._v("\n          收藏景點\n          "),r("b-badge",{staticClass:"favorite-count",attrs:{variant:"light"}},[e._v("\n            "+e._s(e.favoriteCount)+"\n          ")])],1),e._v(" "),r("li",{on:{click:e.goSetting}},[e._v("\n          個人設定\n        ")]),e._v(" "),r("li",{on:{click:e.singout}},[e._v("\n          登出\n        ")])]):r("ul",{staticClass:"user-function"},["/"!==e.$route.path?r("li",{staticClass:"link-style",on:{click:e.goIndex}},[e._v("\n          回首頁\n        ")]):e._e(),e._v(" "),r("nuxt-link",{staticClass:"link-style",attrs:{to:"/login",tag:"li"}},[e._v("\n          登入\n        ")])],1),e._v(" "),r("div",{staticClass:"close-wrap"},[r("font-awesome-icon",{staticClass:"menu-icon2",attrs:{icon:"times"},on:{click:e.toggleMenu}})],1)]):e._e()],1)])}),[],!1,null,null,null).exports,d={data:function(){return{keywordSearch:""}},methods:{search:function(){this.keywordSearch&&this.$router.push("/search/"+this.keywordSearch)}}},h=(n(388),Object(f.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"search-wrap"},[n("b-container",[n("b-row",[n("b-col",[n("div",{staticClass:"bg-wrap"},t._l(["sm"],(function(e){return n("b-input-group",{key:e,staticClass:"my-3",attrs:{size:e,prepend:"城市: "}},[n("b-form-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.keywordSearch,callback:function(e){t.keywordSearch=e},expression:"keywordSearch"}}),t._v(" "),n("b-input-group-append",[n("b-button",{attrs:{size:"sm",text:"Button",variant:"success"},on:{click:t.search}},[t._v("\n                搜尋\n              ")])],1)],1)})),1)])],1)],1)],1)}),[],!1,null,null,null).exports),m=n(216),j={computed:{show:function(){return this.$store.state.loading}},watch:{show:function(){document.querySelector("body").style.overflow=this.show?"hidden":"auto"}}},v=(n(392),{components:{KeywordSearch:h,userMenu:menu,loading:Object(f.a)(j,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"loading-wrap"},[e("img",{attrs:{src:n(391),alt:""}})])}),[],!1,null,"4746ffce",null).exports},fetch:function(t){var e=t.store;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.a)();case 2:return(n=t.sent)&&e.dispatch("setLoginStatus",n),t.next=6,Object(m.e)();case 6:r=t.sent,e.dispatch("setUserCounter",r);case 8:case"end":return t.stop()}}),t)})))()},scrollToTop:!0}),k=Object(f.a)(v,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("userMenu"),this._v(" "),e("KeywordSearch"),this._v(" "),e("nuxt-child"),this._v(" "),e("loading")],1)}),[],!1,null,null,null);e.default=k.exports}}]);